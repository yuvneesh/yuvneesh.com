<!DOCTYPE HTML>
<html  lang="en">
<head>
    <!-- Required meta tags-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha384-k6vP0k0IIqkj4238c+J4pJocVrMV6F1I8RWyjC8IYFuerqJvR6BGHjo6KOQz+OI4" crossorigin="anonymous">
    
    <script src="{{url_for('static', filename='login.js')}}"></script>

</head>
<title>Login Page</title>
<body>
    <div class="container col-4 mt-4 pt-2">
        <h1 class="text-center">Login</h1>
        <form method="POST" action="">
            {{ form.hidden_tag()}}
            <fieldset class="form-group">
                {% for field in fields %}
                <div class="form-group mt-4">
                    {{ field.label(class="form-control-label")}}
                    {{ field(class="form-control form-control-lg")}}
                </div>    
                {% endfor %}
            </fieldset>
            
            <div class="form-group text-center mt-4 mx-auto"><p id="loginStatus">&#8203;</p></div>
            <div class="form-group d-flex justify-content-between">
            <button type="button" id="login" class="btn btn-primary btn-lg mt-4 mx-auto">Login</button> 
            </div>
            <script>
                document.getElementById("login").onclick = function() {authenticate()};

async function authenticate() {

if (document.getElementById("username").value == ""){
    document.getElementById("loginStatus").innerText = "Please enter a valid username!"
    document.getElementById("loginStatus").style.color = "red"
    return
}
if (document.getElementById("password").value == ""){
    document.getElementById("loginStatus").innerText = "Please enter a password!"
    document.getElementById("loginStatus").style.color = "red"
    return
}
const payload = {
    "username" : document.getElementById("username").value,
    "password" : document.getElementById("password").value
}

const response = await fetch("/authenticate", {
    method: 'POST',
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(payload)
});

const result = await response.json();
    if (result.status) {
        document.getElementById("loginStatus").innerText = "Login Successful"
        document.getElementById("loginStatus").style.color = "green"
    } else {
        document.getElementById("loginStatus").innerText = "Login Failed: Incorrect Username or Password"
        document.getElementById("loginStatus").style.color = "red"
    }
}
            </script>
        </form>
    </div>
</body>
</html>